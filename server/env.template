# 环境变量配置模板
# 复制此文件为 .env 并修改相应配置

# ============================================
# 数据库配置
# ============================================
DB_HOST=127.0.0.1
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=amazon_asin_monitor

# ============================================
# 服务器配置
# ============================================
PORT=3001
NODE_ENV=production

# CORS配置（生产环境使用公网IP或域名）
# 示例：CORS_ORIGIN=http://123.456.789.0
# 如果使用Nginx反向代理，可以设置为：CORS_ORIGIN=http://你的公网IP
CORS_ORIGIN=http://localhost:8000

# ============================================
# Redis配置
# ============================================
# Redis连接配置（用于Bull队列和缓存）
# 方式1：使用完整的Redis URL（推荐，可以在URL中包含密码）
# 格式：redis://[:password@]host[:port][/database]
# 示例（无密码）：redis://127.0.0.1:6379
# 示例（有密码）：redis://:your_password@127.0.0.1:6379
# 示例（用户名+密码，Redis 6.0+）：redis://username:password@127.0.0.1:6379
REDIS_URL=redis://127.0.0.1:6379
REDIS_URI=redis://127.0.0.1:6379

# 方式2：使用单独的配置项（如果REDIS_URL未设置，将使用这些配置构建URL）
# Redis主机地址
REDIS_HOST=127.0.0.1
# Redis端口
REDIS_PORT=6379
# Redis密码（如果Redis设置了密码，请填写）
# REDIS_PASSWORD=your_redis_password
# Redis用户名（Redis 6.0+支持，可选）
# REDIS_USERNAME=your_redis_username
# Redis数据库编号（默认0）
REDIS_DB=0

# ============================================
# JWT认证配置
# ============================================
# JWT密钥（用于token加密，生产环境必须修改）
JWT_SECRET=your_jwt_secret_key_change_this_in_production
# JWT过期时间（默认7天）
JWT_EXPIRES_IN=7d
# 记住我功能的过期时间（默认30天）
JWT_REMEMBER_EXPIRES_IN=30d

# ============================================
# SP-API配置（Amazon Selling Partner API）
# ============================================
# 注意：SP-API配置可以通过前端系统设置页面管理，也可以在这里配置
# 如果同时配置，数据库配置优先

# SP-API LWA配置（Login with Amazon）
# US区域配置
SP_API_US_LWA_CLIENT_ID=your_us_lwa_client_id
SP_API_US_LWA_CLIENT_SECRET=your_us_lwa_client_secret
SP_API_US_REFRESH_TOKEN=your_us_refresh_token

# EU区域配置
SP_API_EU_LWA_CLIENT_ID=your_eu_lwa_client_id
SP_API_EU_LWA_CLIENT_SECRET=your_eu_lwa_client_secret
SP_API_EU_REFRESH_TOKEN=your_eu_refresh_token

# 全局LWA配置（如果区域配置不存在，使用全局配置）
SP_API_LWA_CLIENT_ID=your_lwa_client_id
SP_API_LWA_CLIENT_SECRET=your_lwa_client_secret
SP_API_REFRESH_TOKEN=your_refresh_token

# SP-API AWS配置（用于AWS签名）
SP_API_ACCESS_KEY_ID=your_aws_access_key_id
SP_API_SECRET_ACCESS_KEY=your_aws_secret_access_key
SP_API_ROLE_ARN=arn:aws:iam::YOUR_ACCOUNT_ID:role/sp-api-role

# SP-API功能开关（可通过前端系统设置页面管理）
# 是否启用AWS签名（false=简化模式，无需AWS签名；true=标准模式，需要完整AWS配置）
SP_API_USE_AWS_SIGNATURE=false

# 是否启用HTML抓取兜底（当SP-API失败时使用HTML抓取，有风险）
ENABLE_HTML_SCRAPER_FALLBACK=false

# 是否启用旧客户端备用方案（当标准SP-API失败时使用）
ENABLE_LEGACY_CLIENT_FALLBACK=false

# ============================================
# 监控任务配置
# ============================================
# 每次最多同时检查的变体组数量（默认3，建议2-5）
MONITOR_MAX_CONCURRENT_GROUP_CHECKS=3

# 最大允许的并发数（安全限制，默认10）
MAX_ALLOWED_CONCURRENT_GROUP_CHECKS=10

# 分批处理的总批次数（1=不分批，2+=启用分批处理）
# 分批处理可以分散请求时间，降低限流风险
MONITOR_BATCH_COUNT=1

# 单次任务最多处理的变体组数量（0=不限制）
# 用于防止单次任务过大，避免长时间占用资源
MONITOR_MAX_GROUPS_PER_TASK=0

# 是否启用自动调整并发数（默认启用，设置为false禁用）
# 启用后，系统会根据限流情况自动调整并发数
AUTO_ADJUST_CONCURRENCY=true

# ============================================
# SP-API请求延迟配置（已废弃，由令牌桶限流器替代）
# ============================================
# 注意：这些配置已被令牌桶限流器替代，保留仅用于向后兼容
# 延迟间隔（每多少个请求延迟一次，默认20）
SP_API_REQUEST_DELAY_INTERVAL=20

# 延迟毫秒数（每次延迟多少毫秒，默认150ms）
SP_API_REQUEST_DELAY_MS=150

# ============================================
# SP-API速率限制配置（令牌桶限流器）
# ============================================
# 每分钟允许的请求数（默认60）
# 建议根据SP-API配额设置，不要超过实际配额
SP_API_RATE_LIMIT_PER_MINUTE=60

# 每小时允许的请求数（默认1000）
# 建议根据SP-API配额设置，不要超过实际配额
SP_API_RATE_LIMIT_PER_HOUR=1000

# ============================================
# 缓存配置
# ============================================
# 缓存默认TTL（毫秒，默认30秒）
CACHE_DEFAULT_TTL_MS=30000

# 缓存最大条目数（默认2000）
CACHE_MAX_ENTRIES=2000

# 缓存清理间隔（毫秒，默认60秒）
CACHE_CLEANUP_INTERVAL_MS=60000

# ============================================
# SP-API变体查询缓存配置（已废弃）
# ============================================
# 注意：为保证数据准确性，系统统一使用12分钟缓存时间
# 不再区分有无变体的缓存时间，也不支持通过环境变量配置
# 以下配置项已废弃，保留仅用于向后兼容
# SP_API_VARIANT_CACHE_TTL_MINUTES=30
# SP_API_NO_VARIANT_CACHE_TTL_HOURS=2

# ============================================
# 竞品数据库配置（可选，如果不配置则使用主数据库配置）
# ============================================
# 竞品监控使用独立数据库，确保数据完全隔离
COMPETITOR_DB_HOST=127.0.0.1
COMPETITOR_DB_PORT=3306
COMPETITOR_DB_USER=root
COMPETITOR_DB_PASSWORD=your_password
COMPETITOR_DB_NAME=amazon_competitor_monitor

# ============================================
# 系统全局配置
# ============================================
# 全局告警消息（可选，用于在系统顶部显示全局通知）
GLOBAL_ALERT_MESSAGE=

# 全局告警类型（info/warning/error，默认info）
GLOBAL_ALERT_TYPE=info

